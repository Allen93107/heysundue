@model Heysundue.Models.Joinlist2ViewModel
@using Heysundue.Models;

@{
    ViewData["Title"] = "報名人員管理系統";
}

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>報名人員管理系統</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
    <h2 class="mb-4">報名人員名單</h2>

    <div class="row mb-3">
        <div class="col-auto">
            <button class="btn btn-primary mb-2" onclick="showAddParticipantModal()">新增人員</button>
        </div>
    </div>
        <form id="searchForm" method="post" action="@Url.Action("SearchJoinlist", "Joinlist")">
            <div class="row mb-3">
                <!-- 搜尋欄位選擇 -->
        <!-- 搜尋輸入框 -->
        <div class="row mb-3">
            <div class="col-md-8">
                <input type="text" id="searchKeyword" name="SearchKeyword" class="form-control" placeholder="請輸入關鍵字" />
            </div>

            <div class="col-md-4">
                <button type="submit" class="btn btn-primary">搜尋</button>
                <button type="button" class="btn btn-secondary" onclick="clearSearch()">清除</button>
            </div>
        </div>
                <!-- 搜尋按鈕 -->
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary">搜尋</button>
                    <button type="button" class="btn btn-secondary" onclick="clearSearch()">清除</button>
                </div>
            </div>
        </form>

        <!-- 表格 -->
        <div class="row mb-3">
            <div class="col">
                <table class="table">
                    <thead class="custom-table-header">
                        <tr>
                            <th>Reg. No.</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>中文姓名</th>
                            <th>Country</th>
                            <th>報到狀態</th>
                            <th>Barcode</th>
                            <th>Email</th>
                            <th>City</th>
                            <th>身份別一</th>
                            <th>身份別二</th>
                            <th>身份證號碼</th>
                        </tr>
                    </thead>
                <tbody id="joinlistTableBody">
                    @if (Model.Joinlists != null)
                    {
                        foreach (var joinlist in Model.Joinlists)
                        {
                            <tr>
                                <td>
                                    <a href="@Url.Action("Edit", "Joinlist", new { id = joinlist.ID })">@joinlist.RegNo</a>
                                </td>
                                <td>@joinlist.FirstName</td>
                                <td>@joinlist.LastName</td>
                                <td>@joinlist.ChineseName</td>
                                <td>@joinlist.Country</td>
                                <td>@joinlist.RegistrationStatus</td>
                                <td>@joinlist.Barcode</td>
                                <td>@joinlist.Email</td>
                                <td>@joinlist.City</td>
                                <td>@joinlist.IdentityType1</td>
                                <td>@joinlist.IdentityType2</td>
                                <td>@joinlist.IDNumber</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="12">No joinlists available.</td>
                        </tr>
                    }
                </tbody>

                </table>
            </div>
        </div>

        <div id="pagination" class="row">
            <div class="col text-center">
                <button class="btn btn-primary" onclick="previousPage()" @(Model.CurrentPage <= 1 ? "disabled" : "")>上一頁</button>
                <span>頁數: @Model.CurrentPage / @Model.TotalPages</span> <!-- 頁數由後端動態生成 -->
                <button class="btn btn-primary" onclick="nextPage()" @(Model.CurrentPage >= Model.TotalPages ? "disabled" : "")>下一頁</button>
            </div>
        </div>
    </div>
<!-- 新增人員 Modal -->
    <div class="modal fade" id="addParticipantModal" tabindex="-1" aria-labelledby="addParticipantModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addParticipantModalLabel">新增人員</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
    <div class="modal-body">
     <form id="addParticipantForm" method="post" action="@Url.Action("AddJoinlist", "Joinlist")">
    <div asp-validation-summary="All" class="text-danger"></div>

    <!-- Reg. No. -->
    <div class="mb-3">
        <label asp-for="Joinlist.RegNo" class="form-label">Reg. No. <span class="text-danger">*</span></label>
        <input asp-for="Joinlist.RegNo" class="form-control" required />
        <span asp-validation-for="Joinlist.RegNo" class="text-danger"></span>
    </div>

    <!-- First Name -->
    <div class="mb-3">
        <label asp-for="Joinlist.FirstName" class="form-label">First Name <span class="text-danger">*</span></label>
        <input asp-for="Joinlist.FirstName" class="form-control" required />
        <span asp-validation-for="Joinlist.FirstName" class="text-danger"></span>
    </div>

    <!-- Last Name -->
    <div class="mb-3">
        <label asp-for="Joinlist.LastName" class="form-label">Last Name <span class="text-danger">*</span></label>
        <input asp-for="Joinlist.LastName" class="form-control" required />
        <span asp-validation-for="Joinlist.LastName" class="text-danger"></span>
    </div>

    <!-- 中文姓名 -->
    <div class="mb-3">
        <label asp-for="Joinlist.ChineseName" class="form-label">中文姓名 <span class="text-danger">*</span></label>
        <input asp-for="Joinlist.ChineseName" class="form-control" required />
        <span asp-validation-for="Joinlist.ChineseName" class="text-danger"></span>
    </div>

    <!-- Country -->
    <div class="mb-3">
        <label asp-for="Joinlist.Country" class="form-label">Country <span class="text-danger">*</span></label>
        <input asp-for="Joinlist.Country" class="form-control" required />
        <span asp-validation-for="Joinlist.Country" class="text-danger"></span>
    </div>

    <!-- Email -->
    <div class="mb-3">
        <label asp-for="Joinlist.Email" class="form-label">Email</label>
        <input asp-for="Joinlist.Email" class="form-control" />
        <span asp-validation-for="Joinlist.Email" class="text-danger"></span>
    </div>

    <!-- City -->
    <div class="mb-3">
        <label asp-for="Joinlist.City" class="form-label">City</label>
        <input asp-for="Joinlist.City" class="form-control" />
        <span asp-validation-for="Joinlist.City" class="text-danger"></span>
    </div>

    <!-- Identity Type 1 -->
    <div class="mb-3">
        <label asp-for="Joinlist.IdentityType1" class="form-label">身份別一</label>
        <input asp-for="Joinlist.IdentityType1" class="form-control" />
        <span asp-validation-for="Joinlist.IdentityType1" class="text-danger"></span>
    </div>

    <!-- Identity Type 2 -->
    <div class="mb-3">
        <label asp-for="Joinlist.IdentityType2" class="form-label">身份別二</label>
        <input asp-for="Joinlist.IdentityType2" class="form-control" />
        <span asp-validation-for="Joinlist.IdentityType2" class="text-danger"></span>
    </div>

    <!-- ID Number -->
    <div class="mb-3">
        <label asp-for="Joinlist.IDNumber" class="form-label">身份證號碼</label>
        <input asp-for="Joinlist.IDNumber" class="form-control" />
        <span asp-validation-for="Joinlist.IDNumber" class="text-danger"></span>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="submit" class="btn btn-primary">新增</button>
    </div>
</form>
       
    </div>


    <!-- 加載 jQuery 和 Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 監聽選擇欄位的變化，根據選擇啟用或禁用搜尋框
        $('#searchColumn').on('change', function() {
            if ($(this).val() === 'all') {
                $('#searchKeyword').val('');
                $('#searchKeyword').attr('disabled', true);
            } else {
                $('#searchKeyword').removeAttr('disabled');
            }
        });


        // 清除搜尋功能
        function clearSearch() {
            $('#searchKeyword').val('');
        }


        // 分頁功能
        function nextPage() {
            var currentPage = parseInt($('#pagination span').text().split(":")[1].split("/")[0].trim());
            var totalPages = parseInt($('#pagination span').text().split("/")[1].trim());
            if (currentPage < totalPages) {
                loadPage(currentPage + 1);
            }
        }

        function previousPage() {
            var currentPage = parseInt($('#pagination span').text().split(":")[1].split("/")[0].trim());
            if (currentPage > 1) {
                loadPage(currentPage - 1);
            }
        }
        
            function loadPage(page) {
        $.ajax({
            url: '@Url.Action("Joinlist2", "Joinlist")',
            type: 'GET',
            data: { page: page },
            success: function (response) {
                // 更新表格內容
                $('#joinlistTableBody').html($(response).find('#joinlistTableBody').html());
                // 更新分頁
                $('#pagination').html($(response).find('#pagination').html());
            },
            error: function () {
                alert('無法加載頁面，請稍後再試。');
            }
        });
    }


        function showAddParticipantModal() {
            var modal = new bootstrap.Modal(document.getElementById('addParticipantModal'));
            modal.show();
        }



    </script>
</body>
</html>